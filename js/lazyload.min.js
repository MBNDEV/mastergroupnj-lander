document.addEventListener("DOMContentLoaded",function(){
  var lazyImages=[].slice.call(document.querySelectorAll("img.lazyload"));
  
  if("IntersectionObserver" in window){
    let observer=new IntersectionObserver(function(entries,obs){
      entries.forEach(function(entry){
        if(entry.isIntersecting){
          let img=entry.target;
          img.src=img.dataset.src;
          img.removeAttribute("data-src");
          img.classList.remove("lazyload");
          img.classList.add("lazyloaded");
          obs.unobserve(img);
        }
      });
    });
    lazyImages.forEach(function(img){observer.observe(img);});
  }else{
    // fallback for old browsers (IE, old Safari)
    const lazyLoad=function(){
      lazyImages.forEach(function(img){
        if(img.offsetTop<window.innerHeight+window.pageYOffset+300){
          img.src=img.dataset.src;
          img.removeAttribute("data-src");
          img.classList.remove("lazyload");
          img.classList.add("lazyloaded");
        }
      });
    };
    document.addEventListener("scroll",lazyLoad);
    window.addEventListener("resize",lazyLoad);
    window.addEventListener("orientationChange",lazyLoad);
  }
});
